<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Aile HekimliÄŸi</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1f3b27">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --bg:#1f3b27;
  --panel:#2a4a33;
  --card:#f5f1e8;   /* bej/krem */
  --accent:#4caf50;
  --accent2:#2e7d32;
  --text:#0b1f16;
  --muted:#5f6f65;
  --danger:#b23b3b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:linear-gradient(180deg,#1f3b27,#0b1f16);
  color:white;
  padding:16px;
}
h1{
  margin:0 0 12px 0;
  font-size:22px;
  letter-spacing:.3px;
}
.panel{
  background:var(--panel);
  border-radius:22px;
  padding:16px;
  margin:14px 0;
}
.row{display:flex;gap:10px;flex-wrap:wrap}
.col{flex:1;min-width:150px}

input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  background:var(--card);
  color:var(--text);
  margin:6px 0;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  border-radius:999px;
  border:none;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:white;
  font-weight:700;
  font-size:16px;
}
.cat{
  background:rgba(255,255,255,.08);
  border-radius:16px;
  padding:12px;
  margin:10px 0;
}
.cat label{font-weight:600}
.card{
  background:var(--card);
  color:var(--text);
  border-radius:20px;
  padding:14px;
  margin-top:12px;
}
.small{font-size:12px;color:var(--muted)}
.btn-danger{
  background:transparent;
  color:var(--danger);
  border:1px solid var(--danger);
  padding:8px 12px;
  border-radius:999px;
  margin-top:8px;
}
</style>

<!-- Firebase (aynÄ± senkron) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhRWEiA-rrpuazR_YnV7UmhQ-UiDeAHUU",
  authDomain: "aile-hekimligi-paneli.firebaseapp.com",
  projectId: "aile-hekimligi-paneli"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const KATS=[
 "Hipertansiyon","DM","KVR","Obezite",
 "YaÅŸlÄ± Ä°zlem","KAH Ä°zlem","Ä°nme Ä°zlem",
 "KBH Ä°zlem","KOAH Ä°zlem","AstÄ±m Ä°zlem"
];
const ILK4=["Hipertansiyon","DM","KVR","Obezite"];
let ALL=[];

window.onload=()=>{
  const h=document.getElementById("kats");
  KATS.forEach(k=>{
    h.innerHTML+=`
    <div class="cat">
      <label><input type="checkbox" data-k="${k}"> ${k}</label>
      ${ILK4.includes(k)?`
        <select data-a="${k}">
          <option value="">Tarama / Ä°zlem</option>
          <option>Tarama</option>
          <option>Ä°zlem</option>
        </select>`:""}
      <input placeholder="HYP tarihi" data-h="${k}">
    </div>`;
  });
  load();
};

async function ekle(){
  if(!ad.value||!tc.value) return alert("Ad ve TC zorunlu");
  const ks=[];
  document.querySelectorAll("[data-k]").forEach(c=>{
    if(c.checked){
      const k=c.dataset.k;
      const a=document.querySelector(`[data-a="${k}"]`)?.value||"";
      if(ILK4.includes(k)&&!a) return alert(k+" iÃ§in Tarama/Ä°zlem");
      ks.push({kategori:k,alt:a,hyp:document.querySelector(`[data-h="${k}"]`).value});
    }
  });
  if(!ks.length) return alert("Kategori seÃ§");
  await addDoc(collection(db,"patients"),{
    ad:ad.value, tc:tc.value, kategoriler:ks, createdAt:new Date()
  });
  load();
}

async function load(){
  const q=query(collection(db,"patients"),orderBy("createdAt","desc"));
  const s=await getDocs(q);
  ALL=[];
  s.forEach(d=>ALL.push({...d.data(),id:d.id}));
  filtre();
}

function filtre(){
  const fa=fad.value.toLowerCase();
  const ft=ftc.value;
  const fk=fkat.value;
  list.innerHTML="";
  ALL.filter(r=>
    (!fa||r.ad.toLowerCase().includes(fa)) &&
    (!ft||r.tc.includes(ft)) &&
    (!fk||r.kategoriler.some(x=>x.kategori===fk))
  ).forEach(r=>{
    list.innerHTML+=`
    <div class="card">
      <b>${r.ad}</b><br>
      <span class="small">TC: ${r.tc}</span>
      ${r.kategoriler.map(x=>`<div>â€¢ ${x.kategori} ${x.alt||""} ${x.hyp||""}</div>`).join("")}
      <button class="btn-danger" onclick="sil('${r.id}')">Sil</button>
    </div>`;
  });
}
window.sil=async id=>{
  if(confirm("Silinsin mi?")){
    await deleteDoc(doc(db,"patients",id));
    load();
  }
};
window.ekle=ekle;
window.filtre=filtre;
</script>
</head>

<body>
<h1>ðŸŒ² Aile HekimliÄŸi</h1>

<div class="panel">
  <div class="row">
    <div class="col"><input id="ad" placeholder="Ad Soyad"></div>
    <div class="col"><input id="tc" placeholder="TC"></div>
  </div>
  <div id="kats"></div>
  <button onclick="ekle()">Kaydet</button>
</div>

<div class="panel">
  <div class="row">
    <div class="col"><input id="fad" placeholder="Ä°sim filtre" oninput="filtre()"></div>
    <div class="col"><input id="ftc" placeholder="TC filtre" oninput="filtre()"></div>
    <div class="col">
      <select id="fkat" onchange="filtre()">
        <option value="">Kategori</option>
        ${KATS.map(k=>`<option>${k}</option>`).join("")}
      </select>
    </div>
  </div>
</div>

<div class="panel">
  <div id="list">YÃ¼kleniyorâ€¦</div>
</div>
</body>
</html>
