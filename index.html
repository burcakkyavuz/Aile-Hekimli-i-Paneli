<!doctype html>
<html lang="tr">
<head>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="apple-mobile-web-app-title" content="Aile HekimliÄŸi">
<title>Aile HekimliÄŸi</title>

<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="theme-color" content="#1f3b27">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --forest:#1f3b27; --forest2:#0b1f16; --panel:#2a4a33;
  --cream:#f5f1e8; --cream2:#efe6d8; --text:#0b1f16;
  --accent:#2e7d32; --accent2:#4caf50; --danger:#b23b3b;
}
*{box-sizing:border-box}
body{
body{
  padding-top: calc(16px + env(safe-area-inset-top));
  padding-bottom: calc(16px + env(safe-area-inset-bottom));
}

  <!-- ğŸ”’ ÅÄ°FRE EKRANI -->
<div id="loginScreen" style="
  position:fixed;
  inset:0;
  background:linear-gradient(180deg,#1f3b27,#0b1f16);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
">
  <div style="
    background:#f5f1e8;
    padding:24px;
    border-radius:20px;
    width:90%;
    max-width:320px;
    text-align:center;
  ">
    <h2 style="color:#1f3b27">ğŸ”’ GiriÅŸ</h2>
    <input id="passwordInput" type="password" placeholder="Åifre">
    <button onclick="checkPassword()">GiriÅŸ</button>
    <div id="loginError" style="color:#b23b3b;font-size:13px;display:none;margin-top:8px">
      Åifre yanlÄ±ÅŸ
    </div>
  </div>
</div>

  margin:0;
  font-family:-apple-system,system-ui;
  background:linear-gradient(180deg,var(--forest),var(--forest2));
  color:#fff;
  padding:16px;
}
h1{margin:0 0 10px 0}
.panel{background:var(--panel);border-radius:22px;padding:16px;margin:14px 0;}
input,select{
  width:100%;padding:12px;border-radius:14px;border:none;
  background:var(--cream);color:var(--text);margin:6px 0;
}
button{
  width:100%;padding:14px;border-radius:999px;border:none;
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  color:white;font-weight:800;cursor:pointer;
}
.tabbar{display:flex;gap:10px;margin-bottom:12px}
.tab{
  flex:1;padding:12px;border-radius:999px;
  background:rgba(255,255,255,.12);text-align:center;
  font-weight:800;cursor:pointer;
}
.tab.active{background:var(--cream);color:var(--text)}
.cat-card{
  background:var(--cream2);color:var(--text);
  border-radius:18px;padding:14px;margin-top:10px;position:relative;
}
.remove{position:absolute;top:10px;right:12px;color:var(--danger);cursor:pointer}
.list-card{
  background:var(--cream);color:var(--text);
  border-radius:20px;padding:14px;margin-top:12px;
}
.badge{
  display:inline-block;margin:4px 6px 0 0;padding:3px 10px;
  border-radius:999px;font-size:12px;
  background:rgba(46,125,50,.12);
}
.btn-danger{
  background:transparent;color:var(--danger);
  border:1px solid var(--danger);
  padding:8px;border-radius:999px;margin-top:8px;
}
</style>

<!-- ğŸ”’ ÅÄ°FRE EKRANI -->
<div id="loginScreen" style="
  position:fixed;inset:0;
  background:linear-gradient(180deg,#1f3b27,#0b1f16);
  display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="background:#f5f1e8;padding:24px;border-radius:20px;width:90%;max-width:320px;text-align:center">
    <h2 style="color:#1f3b27">ğŸ”’ GiriÅŸ</h2>
    <input id="passwordInput" type="password" placeholder="Åifre">
    <button onclick="checkPassword()">GiriÅŸ</button>
    <div id="loginError" style="color:#b23b3b;font-size:13px;display:none;margin-top:8px">
      Åifre yanlÄ±ÅŸ
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhRWEiA-rrpuazR_YnV7UmhQ-UiDeAHUU",
  authDomain: "aile-hekimligi-paneli.firebaseapp.com",
  projectId: "aile-hekimligi-paneli"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const KATS=["Hipertansiyon","DM","KVR","Obezite","YaÅŸlÄ± Ä°zlem","KAH Ä°zlem","Ä°nme Ä°zlem","KBH Ä°zlem","KOAH Ä°zlem","AstÄ±m Ä°zlem"];
const ILK4=new Set(["Hipertansiyon","DM","KVR","Obezite"]);

let selected=[], ALL=[];

const q=id=>document.getElementById(id);

function showTab(t){
  newTab.style.display=t==="new"?"block":"none";
  listTab.style.display=t==="list"?"block":"none";
  tNew.classList.toggle("active",t==="new");
  tList.classList.toggle("active",t==="list");
}

window.onload=async()=>{
  katSec.innerHTML=`<option value="">Kategori seÃ§</option>`+KATS.map(k=>`<option>${k}</option>`).join("");
  fkat.innerHTML=`<option value="">Kategori</option>`+KATS.map(k=>`<option>${k}</option>`).join("");
  await load();
};

window.katEkle=()=>{
  if(!katSec.value||selected.some(x=>x.kategori===katSec.value))return;
  selected.push({kategori:katSec.value,alt:"",hyp:""});
  render();
};

function render(){
  cards.innerHTML="";
  selected.forEach((x,i)=>{
    cards.innerHTML+=`
    <div class="cat-card">
      <div class="remove" onclick="selected.splice(${i},1);render()">ğŸ—‘ï¸</div>
      <b>${x.kategori}</b>
      ${ILK4.has(x.kategori)?`
      <select onchange="selected[${i}].alt=this.value">
        <option value="">Tarama / Ä°zlem</option><option>Tarama</option><option>Ä°zlem</option>
      </select>`:""}
      <input placeholder="HYP tarihi" oninput="selected[${i}].hyp=this.value">
    </div>`;
  });
}

window.ekle=async()=>{
  if(!ad.value||!tc.value||!selected.length)return alert("Eksik bilgi");
  await addDoc(collection(db,"patients"),{
    ad:ad.value,tc:tc.value,
    kategoriler:selected.map(x=>({
      kategori:x.kategori,
      alt:ILK4.has(x.kategori)?(x.alt||"Ä°zlem"):"",
      hyp:x.hyp||""
    }))
  });
  ad.value="";tc.value="";selected=[];render();
  await load();showTab("list");
};

async function load(){
  const s=await getDocs(collection(db,"patients"));
  ALL=[];s.forEach(d=>ALL.push({id:d.id,...d.data()}));
  list.innerHTML="";
  ALL.forEach(r=>{
    list.innerHTML+=`
    <div class="list-card">
      <b>${r.ad}</b><br>TC: ${r.tc}
      <div>${r.kategoriler.map(k=>`<span class="badge">${k.kategori}</span>`).join("")}</div>
      <button class="btn-danger" onclick="sil('${r.id}')">Sil</button>
    </div>`;
  });
}

window.sil=async id=>{
  if(confirm("Silinsin mi?")){
    await deleteDoc(doc(db,"patients",id));
    load();
  }
};
</script>

<script>
const APP_PASSWORD="826747"; // ğŸ‘ˆ BURAYI DEÄÄ°ÅTÄ°R

function checkPassword(){
  if(passwordInput.value===APP_PASSWORD){
    loginScreen.style.display="none";
    sessionStorage.setItem("ok","1");
  }else loginError.style.display="block";
}
if(sessionStorage.getItem("ok")==="1"){
  window.onload=()=>loginScreen.style.display="none";
}
</script>

<body>
<h1>ğŸŒ² Aile HekimliÄŸi</h1>

<div class="tabbar">
  <div id="tNew" class="tab active" onclick="showTab('new')">â• Yeni Hasta</div>
  <div id="tList" class="tab" onclick="showTab('list')">ğŸ“‹ Hasta Listesi</div>
</div>

<div id="newTab">
  <div class="panel">
    <input id="ad" placeholder="Ad Soyad">
    <input id="tc" placeholder="TC">
    <select id="katSec"></select>
    <button onclick="katEkle()">+ Kategori Ekle</button>
    <div id="cards"></div>
    <button onclick="ekle()">Kaydet</button>
  </div>
</div>

<div id="listTab" style="display:none">
  <div class="panel">
    <select id="fkat"></select>
    <div id="list"></div>
  </div>
</div>
<script>
const APP_PASSWORD = "826747"; // ğŸ‘ˆ ÅŸifren (deÄŸiÅŸtirebilirsin)

function checkPassword(){
  const val = document.getElementById("passwordInput").value;
  if(val === APP_PASSWORD){
    document.getElementById("loginScreen").style.display = "none";
    sessionStorage.setItem("loggedIn","1");
  }else{
    document.getElementById("loginError").style.display = "block";
  }
}

// aynÄ± sekmede tekrar sormasÄ±n
if(sessionStorage.getItem("loggedIn")==="1"){
  document.addEventListener("DOMContentLoaded",()=>{
    document.getElementById("loginScreen").style.display="none";
  });
}
</script>

</body>
</html>
