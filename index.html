<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Aile HekimliÄŸi Paneli</title>
<meta name="theme-color" content="#0b1f16">

<style>
:root{
  --bg:#0b1f16;
  --panel:#10271c;
  --card:#153424;
  --accent:#4caf50;
  --accent2:#2e7d32;
  --text:#f4fff6;
  --muted:#a7c9b0;
  --danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:radial-gradient(circle at top,#1f3b27 0,#0b1f16 55%,#05120b 100%);
  color:var(--text);
  padding:16px;
}
h1{margin:0 0 6px 0;color:#a5d6a7;font-size:22px}
.small{font-size:12px;color:var(--muted)}
.panel{
  background:var(--panel);
  border-radius:14px;
  padding:14px;
  margin:12px 0;
  border:1px solid rgba(255,255,255,0.06);
}
.row{display:flex;gap:10px;flex-wrap:wrap}
.col{flex:1;min-width:160px}
input,select,textarea,button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(8,25,16,0.85);
  color:var(--text);
  font-size:14px;
}
textarea{min-height:70px}
button{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  font-weight:700;
  cursor:pointer;
}
.cat{background:#0e2318;border-radius:12px;padding:10px;margin:8px 0}
.cat label{display:flex;gap:8px;align-items:center}
.cat-fields{margin-top:6px}
.card{
  background:var(--card);
  border-radius:12px;
  padding:10px;
  margin-top:10px;
  border:1px solid rgba(255,255,255,0.06);
}
.btn-danger{
  background:#5b1c1c;
  color:#ffdede;
  border:none;
  padding:6px 10px;
  border-radius:8px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, orderBy, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhRWEiA-rrpuazR_YnV7UmhQ-UiDeAHUU",
  authDomain: "aile-hekimligi-paneli.firebaseapp.com",
  projectId: "aile-hekimligi-paneli",
  storageBucket: "aile-hekimligi-paneli.firebasestorage.app",
  messagingSenderId: "661070000720",
  appId: "1:661070000720:web:7e657b58ba337f3ef55755"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const KATS = [
 "Hipertansiyon","DM","KVR","Obezite",
 "YaÅŸlÄ± Ä°zlem","KAH Ä°zlem","Ä°nme Ä°zlem",
 "KBH Ä°zlem","KOAH Ä°zlem","AstÄ±m Ä°zlem"
];
const ILK4 = ["Hipertansiyon","DM","KVR","Obezite"];

window.onload = () => {
  const host = document.getElementById("kats");
  KATS.forEach(k=>{
    host.innerHTML += `
      <div class="cat">
        <label><input type="checkbox" data-k="${k}"> ${k}</label>
        <div class="cat-fields">
          ${ILK4.includes(k)?`
          <select data-a="${k}">
            <option value="">Tarama / Ä°zlem</option>
            <option>Tarama</option>
            <option>Ä°zlem</option>
          </select>`:""}
          <input placeholder="HYP tarihi" data-h="${k}">
        </div>
      </div>`;
  });
  load();
};

async function ekle(){
  const ad = adsoyad.value.trim();
  const tc = tcno.value.trim();
  if(!ad||!tc) return alert("Ad ve TC zorunlu");

  const kategoriler=[];
  document.querySelectorAll("[data-k]").forEach(c=>{
    if(c.checked){
      const k=c.dataset.k;
      const a=document.querySelector(`[data-a="${k}"]`)?.value||"";
      const h=document.querySelector(`[data-h="${k}"]`)?.value||"";
      if(ILK4.includes(k)&&!a) return alert(k+" iÃ§in Tarama/Ä°zlem seÃ§");
      kategoriler.push({kategori:k,alt:a,hyp:h});
    }
  });
  if(!kategoriler.length) return alert("Kategori seÃ§");

  await addDoc(collection(db,"patients"),{
    ad,tc,kategoriler,createdAt:new Date()
  });
  load();
}

async function load(){
  const q=query(collection(db,"patients"),orderBy("createdAt","desc"));
  const s=await getDocs(q);
  list.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    list.innerHTML+=`
      <div class="card">
        <b>${r.ad}</b> â€“ ${r.tc}
        ${r.kategoriler.map(x=>`<div>â€¢ ${x.kategori} ${x.alt||""} ${x.hyp||""}</div>`).join("")}
        <button class="btn-danger" onclick="sil('${d.id}')">Sil</button>
      </div>`;
  });
}
window.ekle=ekle;
window.sil=async id=>{
  if(confirm("Silinsin mi?")){
    await deleteDoc(doc(db,"patients",id));
    load();
  }
};
</script>
</head>

<body>
<h1>ðŸŒ² Aile HekimliÄŸi Paneli</h1>

<div class="panel">
  <div class="row">
    <div class="col"><input id="adsoyad" placeholder="Ad Soyad"></div>
    <div class="col"><input id="tcno" placeholder="TC"></div>
  </div>
  <div id="kats"></div>
  <button onclick="ekle()">Kaydet</button>
</div>

<div class="panel">
  <div id="list">YÃ¼kleniyorâ€¦</div>
</div>
</body>
</html>
