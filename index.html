<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Aile HekimliÄŸi Paneli</title>
<meta name="theme-color" content="#0b1f16">

<style>
:root{
  --bg:#0b1f16;
  --panel:#10271c;
  --card:#153424;
  --accent:#4caf50;
  --accent2:#2e7d32;
  --text:#f4fff6;
  --muted:#a7c9b0;
  --danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:radial-gradient(circle at top,#1f3b27 0,#0b1f16 55%,#05120b 100%);
  color:var(--text);
  padding:16px;
}
h1{color:#a5d6a7;font-size:22px}
.small{font-size:12px;color:var(--muted)}
.panel{
  background:var(--panel);
  border-radius:14px;
  padding:14px;
  margin:12px 0;
}
.row{display:flex;gap:8px;flex-wrap:wrap}
.col{flex:1;min-width:140px}
input,select,button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#0e2318;
  color:white;
}
button{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  font-weight:700;
}
.cat{background:#0e2318;border-radius:10px;padding:8px;margin:6px 0}
.card{
  background:var(--card);
  border-radius:12px;
  padding:10px;
  margin-top:10px;
}
.btn-danger{
  background:#5b1c1c;
  color:#ffdede;
  padding:6px 10px;
  border-radius:8px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhRWEiA-rrpuazR_YnV7UmhQ-UiDeAHUU",
  authDomain: "aile-hekimligi-paneli.firebaseapp.com",
  projectId: "aile-hekimligi-paneli"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const KATS=["Hipertansiyon","DM","KVR","Obezite","YaÅŸlÄ± Ä°zlem","KAH Ä°zlem","Ä°nme Ä°zlem","KBH Ä°zlem","KOAH Ä°zlem","AstÄ±m Ä°zlem"];
const ILK4=["Hipertansiyon","DM","KVR","Obezite"];
let ALL=[];

window.onload=()=>{
  const k=document.getElementById("kats");
  KATS.forEach(x=>{
    k.innerHTML+=`
    <div class="cat">
      <label><input type="checkbox" data-k="${x}"> ${x}</label>
      ${ILK4.includes(x)?`<select data-a="${x}"><option></option><option>Tarama</option><option>Ä°zlem</option></select>`:""}
      <input placeholder="HYP tarihi" data-h="${x}">
    </div>`;
  });
  load();
};

async function ekle(){
  if(!ad.value||!tc.value) return alert("Ad ve TC");
  const kats=[];
  document.querySelectorAll("[data-k]").forEach(c=>{
    if(c.checked){
      const k=c.dataset.k;
      const a=document.querySelector(`[data-a="${k}"]`)?.value||"";
      if(ILK4.includes(k)&&!a) return alert(k+" Tarama/Ä°zlem");
      kats.push({k,a,h:document.querySelector(`[data-h="${k}"]`).value});
    }
  });
  await addDoc(collection(db,"patients"),{ad:ad.value,tc:tc.value,kats});
  load();
}

async function load(){
  const s=await getDocs(collection(db,"patients"));
  ALL=[];
  s.forEach(d=>ALL.push({...d.data(),id:d.id}));
  draw();
}

function draw(){
  const fAd=fad.value.toLowerCase();
  const fTc=ftc.value;
  const fK=fkat.value;
  list.innerHTML="";
  ALL.filter(r=>
    (!fAd||r.ad.toLowerCase().includes(fAd)) &&
    (!fTc||r.tc.includes(fTc)) &&
    (!fK||r.kats.some(k=>k.k===fK))
  ).forEach(r=>{
    list.innerHTML+=`
    <div class="card">
      <b>${r.ad}</b> â€“ ${r.tc}
      ${r.kats.map(k=>`<div>â€¢ ${k.k} ${k.a||""} ${k.h||""}</div>`).join("")}
      <button class="btn-danger" onclick="sil('${r.id}')">Sil</button>
    </div>`;
  });
}

window.sil=async id=>{
  if(confirm("Silinsin mi?")){
    await deleteDoc(doc(db,"patients",id));
    load();
  }
};
window.ekle=ekle;
window.filtre=draw;
</script>
</head>

<body>
<h1>ðŸŒ² Aile HekimliÄŸi Paneli</h1>

<div class="panel">
  <div class="row">
    <div class="col"><input id="ad" placeholder="Ad Soyad"></div>
    <div class="col"><input id="tc" placeholder="TC"></div>
  </div>
  <div id="kats"></div>
  <button onclick="ekle()">Kaydet</button>
</div>

<div class="panel">
  <div class="row">
    <div class="col"><input id="fad" placeholder="Ä°sim filtre" oninput="filtre()"></div>
    <div class="col"><input id="ftc" placeholder="TC filtre" oninput="filtre()"></div>
    <div class="col">
      <select id="fkat" onchange="filtre()">
        <option value="">Kategori</option>
        ${KATS.map(k=>`<option>${k}</option>`).join("")}
      </select>
    </div>
  </div>
</div>

<div class="panel">
  <div id="list"></div>
</div>
</body>
</html>
