<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Aile HekimliÄŸi Paneli</title>
<meta name="theme-color" content="#0b1f16">

<style>
:root{
  --bg:#0b1f16;
  --bg2:#10271c;
  --card:#153424;
  --accent:#4caf50;
  --accent2:#2e7d32;
  --text:#f4fff6;
  --muted:#a7c9b0;
  --danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:radial-gradient(circle at top,#1f3b27 0,#0b1f16 55%,#05120b 100%);
  color:var(--text);
  padding:16px;
}
h1{
  margin:0 0 8px 0;
  color:#a5d6a7;
  font-size:22px;
}
.small{font-size:12px;color:var(--muted)}
.panel{
  background:var(--bg2);
  border-radius:16px;
  padding:16px;
  margin:14px 0;
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.row{display:flex;gap:10px;flex-wrap:wrap}
.col{flex:1;min-width:160px}
input,select,textarea,button{
  width:100%;
  margin:6px 0;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.12);
  background:rgba(8,25,16,.9);
  color:var(--text);
  font-size:14px;
}
textarea{min-height:70px}
button{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  font-weight:700;
  cursor:pointer;
}
button:active{transform:translateY(1px)}
.cat{
  background:rgba(9,26,18,.9);
  border:1px solid rgba(255,255,255,.08);
  border-radius:14px;
  padding:12px;
  margin:10px 0;
}
.cat label{display:flex;gap:8px;align-items:center;font-weight:600}
.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-top:12px;
  border:1px solid rgba(255,255,255,.08);
}
.btn-danger{
  background:rgba(255,107,107,.15);
  color:#ffd3d3;
  border:1px solid rgba(255,107,107,.5);
  padding:8px 12px;
  border-radius:999px;
  margin-top:8px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs, deleteDoc, doc,
  query, orderBy
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDhRWEiA-rrpuazR_YnV7UmhQ-UiDeAHUU",
  authDomain: "aile-hekimligi-paneli.firebaseapp.com",
  projectId: "aile-hekimligi-paneli",
  storageBucket: "aile-hekimligi-paneli.firebasestorage.app",
  messagingSenderId: "661070000720",
  appId: "1:661070000720:web:7e657b58ba337f3ef55755"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const KATS=[
 "Hipertansiyon","DM","KVR","Obezite",
 "YaÅŸlÄ± Ä°zlem","KAH Ä°zlem","Ä°nme Ä°zlem",
 "KBH Ä°zlem","KOAH Ä°zlem","AstÄ±m Ä°zlem"
];
const ILK4=["Hipertansiyon","DM","KVR","Obezite"];
let ALL=[];

window.onload=()=>{
  const h=document.getElementById("kats");
  KATS.forEach(k=>{
    h.innerHTML+=`
    <div class="cat">
      <label><input type="checkbox" data-k="${k}"> ${k}</label>
      ${ILK4.includes(k)?`
        <select data-a="${k}">
          <option value="">Tarama / Ä°zlem</option>
          <option>Tarama</option>
          <option>Ä°zlem</option>
        </select>`:""}
      <input placeholder="HYP tarihi" data-h="${k}">
    </div>`;
  });
  load();
};

async function ekle(){
  if(!ad.value||!tc.value) return alert("Ad ve TC zorunlu");
  const ks=[];
  document.querySelectorAll("[data-k]").forEach(c=>{
    if(c.checked){
      const k=c.dataset.k;
      const a=document.querySelector(`[data-a="${k}"]`)?.value||"";
      if(ILK4.includes(k)&&!a) return alert(k+" iÃ§in Tarama/Ä°zlem");
      ks.push({kategori:k,alt:a,hyp:document.querySelector(`[data-h="${k}"]`).value});
    }
  });
  if(!ks.length) return alert("Kategori seÃ§");
  await addDoc(collection(db,"patients"),{
    ad:ad.value, tc:tc.value, kategoriler:ks, createdAt:new Date()
  });
  load();
}

async function load(){
  const q=query(collection(db,"patients"),orderBy("createdAt","desc"));
  const s=await getDocs(q);
  ALL=[];
  s.forEach(d=>ALL.push({...d.data(),id:d.id}));
  filtre();
}

function filtre(){
  const fa=fad.value.toLowerCase();
  const ft=ftc.value;
  const fk=fkat.value;
  list.innerHTML="";
  ALL.filter(r=>
    (!fa||r.ad.toLowerCase().includes(fa)) &&
    (!ft||r.tc.includes(ft)) &&
    (!fk||r.kategoriler.some(x=>x.kategori===fk))
  ).forEach(r=>{
    list.innerHTML+=`
    <div class="card">
      <b>${r.ad}</b><br>
      <span class="small">TC: ${r.tc}</span>
      ${r.kategoriler.map(x=>`<div>â€¢ ${x.kategori} ${x.alt||""} ${x.hyp||""}</div>`).join("")}
      <button class="btn-danger" onclick="sil('${r.id}')">Sil</button>
    </div>`;
  });
}

window.sil=async id=>{
  if(confirm("Silinsin mi?")){
    await deleteDoc(doc(db,"patients",id));
    load();
  }
};
window.ekle=ekle;
window.filtre=filtre;
</script>
</head>

<body>
<h1>ðŸŒ² Aile HekimliÄŸi Paneli</h1>

<div class="panel">
  <div class="row">
    <div class="col"><input id="ad" placeholder="Ad Soyad"></div>
    <div class="col"><input id="tc" placeholder="TC"></div>
  </div>
  <div id="kats"></div>
  <button onclick="ekle()">Kaydet</button>
</div>

<div class="panel">
  <div class="row">
    <div class="col"><input id="fad" placeholder="Ä°sim filtre" oninput="filtre()"></div>
    <div class="col"><input id="ftc" placeholder="TC filtre" oninput="filtre()"></div>
    <div class="col">
      <select id="fkat" onchange="filtre()">
        <option value="">Kategori</option>
        ${KATS.map(k=>`<option>${k}</option>`).join("")}
      </select>
    </div>
  </div>
</div>

<div class="panel">
  <div id="list">YÃ¼kleniyorâ€¦</div>
</div>

</body>
</html>
